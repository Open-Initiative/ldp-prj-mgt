<!DOCTYPE html>
<html>
<head>
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=no">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <script type="text/javascript"
          src="http://projects.openinitiative.com/js/jquery-1.7.1.min.js"></script>
  <script type="text/javascript"
          src="http://projects.openinitiative.com/js/jquery-ui-1.9.1.custom.js"></script>
  <script type="text/javascript"
          src="http://testldp.openinitiative.com/mystore.js"></script>
  <title>Test LDP Open Initiative</title>

  <link rel="stylesheet" type="text/css" href="scss/styles.css">

  <!--Le détail du premier tableau -->

  <script id="info-template" type="text/x-handlebars-template">
    <tr>
      <td>
        <a href="#{{[@id]}}" onclick="detailsTask('{{[@id]}}')">{{id}}</a>
      </td>
      <td>{{state}}</td>
      <td class="string"><a href="#{{[@id]}}" onclick="detailsTask('{{[@id]}}')">{{title}}</a></td>
      <td class="string">{{author.fullName}}</td>
      <td class="string">{{target.name}}</td>
      <td class="string">{{comments.length}}</td>
    </tr>
  </script>

  <!--Le premier tableau-->

  <script id="header-template" type="text/x-handlebars-template">
    <h3>Project : {{object.title}}, Id : {{object.id}}</h3>
    Catégorie :{{#ldpeach object.tasks "select"}}<option onclick="renderTable('{{[@id]}}')">{{title}}</option>{{/ldpeach}}
  </script>
  
  <script id="tasks-template" type="text/x-handlebars-template">
    {{#ldpeach object.comments "div"}}
    {{> text }}
    {{/ldpeach}}
    <table id="tasks">
      <thead>
      <tr>
        <th>Id</th>
        <th>État</th>
        <th>Titre</th>
        <th>Auteur</th>
        <th>Lot</th>
        <th>Commentaire(s)</th>
      </tr>
      </thead>
      {{#ldpeach object.descendants "tbody"}}{{> task }}{{/ldpeach}}
    </table>
  </script>

  <!--Les infos sur les commentaires-->

  <script id="info-comment" type="text/x-handlebars-template">
    <div class="field">Date : {{date}}</div>
    <div class="clearfix"></div>
    <div class="longfield">Titre : {{title}}</div>
    <div class="clearfix"></div>
    <textarea readonly>{{text}}</textarea>
  </script>

  <!--Le tableau pour le détaille de la tâche-->

  <script id="details" type="text/x-handlebars-template">
    <h3><a href="#" onclick="hideTask();"><i class="fa fa-angle-left"></i></a>Tâche
      : {{object.title}}</h3>

    <div class="task">
      <div class="details">
        <table>
          <tr>
            <td>État :</td>
            <td>{{object.state}}</td>
          </tr>
          <tr>
            <td>Auteur :</td>
            <td>{{object.author.fullName}}</td>
          </tr>
          <tr>
            <td>Id :</td>
            <td>{{object.id}}</td>
          </tr>
        </table>
        <div class="field"></div>
        <div class="clearfix"></div>
      </div>
      <div class="comments">
        <!--<textarea readonly>Description</textarea>-->
        {{#if object.comments}}
        {{#ldpeach object.comments "div"}}{{> comment }}{{/ldpeach}}
        {{else}}
        <textarea readonly>Pas de commentaire</textarea>
        {{/if}}
      </div>
    </div>

  </script>

  <!--Le javascript qui gère le rendu html-->

  <script>
    $(function () {
      window.store = new MyStore({
        container: "http://pp.projects.openinitiative.com/project/ldpcontainer/154",
        context: "http://owl.openinitiative.com/oicontext.jsonld",
        template: $("#tasks-template").html(),
        partials: {
          task: $("#info-template").html(),
          comment: $("#info-comment").html()
        }
      });
      store.render("#project-header", null, $("#header-template").html());
      renderTable();
    });

    function renderTable(id) {
        //if no id given, renders with default container
        store.render("#list-project", id);
    }

    function detailsTask(id) {
      $('#list-project').hide();
      $('#details-task').show();
      store.render("#details-task", id, $("#details").html());
    }

    function hideTask() {
      $('#details-task').hide();
      $('#list-project').show()
    }
  </script>

</head>
<body>
<h1><i class="fa fa-list-alt"></i>Tableau des tâches du projet</h1>
<div id="project-header"></div>
<div id="list-project"></div>
<div id="details-task"></div>
</body>
</html>
